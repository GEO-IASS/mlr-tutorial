# Visualization

## Generation and plotting functions
[%mlr]'s visualization capabilities rely on *generation functions* which generate data for
plots, and *plotting functions* which plot this output using either [%ggplot2] or [%ggvis]
(the latter being currently experimental).

This separation allows users to easily make custom visualizations by
taking advantage of the generation functions. The only data transformation that is handled inside
plotting functions is reshaping. The reshaped data is also accessible by calling the plotting
functions and then extracting the data from the [&ggplot2::ggplot] object.

The functions are named accordingly.

* Names of generation functions start with `generate` and are followed by a title-case description of
  their `FunctionPurpose`, followed by `Data`, i.e., `generateFunctionPurposeData`.
  These functions output objects of class `FunctionPurposeData`.
* Plotting functions are prefixed by `plot` followed by their purpose, i.e., `plotFunctionPurpose`.
* [%ggvis] plotting functions have an additional suffix `GGVIS`, i.e., `plotFunctionPurposeGGVIS`.

In the example below we create a plot of classifier performance as function of the decision
threshold for the binary classification problem [&sonar.task].
The generation function [&generateThreshVsPerfData] creates an object of class
[ThreshVsPerfData](&generateThreshVsPerfData) which contains the data for the plot in slot
`$data`.

```{r}
lrn = makeLearner("classif.lda", predict.type = "prob")
n = getTaskSize(sonar.task)
mod = train(lrn, task = sonar.task, subset = seq(1, n, by = 2))
pred = predict(mod, task = sonar.task, subset = seq(2, n, by = 2))
d = generateThreshVsPerfData(pred, measures = list(fpr, fnr, mmce))

class(d)

head(d$data)
```

For plotting we can use the built-in [%mlr] function [&plotThreshVsPerf].

```{r, fig.width = 8, fig.height = 4}
plotThreshVsPerf(d)
```

Note that by default the [Measure](&makeMeasure) `name`s are used to annotate the plot.
```{r}
fpr$name

fpr$id
```
This does not only apply to [&plotThreshVsPerf], but to most other plot functions that
show performance measures.
You can use the `id`s instead of the names by setting `pretty.names = FALSE`.


Instead of using the built-in function [&plotThreshVsPerf] we could also manually create the plot
based on the output of [&generateThreshVsPerfData]: in this case to plot only one measure.

```{r, fig.width = 6, fig.height = 4}
ggplot(d$data, aes(threshold, fpr)) + geom_line()
```

The decoupling of generation and plotting functions is especially practical for all users
who prefer traditional [%graphics] or [%lattice]. Here is a [%lattice] plot which gives a
result similar to that of [&plotThreshVsPerf].


```{r, fig.width = 8, fig.height = 4}
lattice::xyplot(fpr + fnr + mmce ~ threshold, data = d$data, type = "l", ylab = "performance",
  outer = TRUE, scales = list(relation = "free"),
  strip = strip.custom(factor.levels = sapply(d$measures, function(x) x$name)))
```


Let's conclude with a brief look on a second example.
Here we use [&plotPartialPrediction] but extract the data from the plot object and use it
to create a traditional [&graphics::plot], additional to the [%ggplot2] plot.

```{r, fig.width = 6, fig.height = 4}
sonar = getTaskData(sonar.task)
pd = generatePartialPredictionData(mod, sonar, "V11")
plt = plotPartialPrediction(pd)
head(plt$data)

plt
```

```{r, fig.width = 6, fig.height = 5}
plot(Probability ~ Value, data = plt$data, type = "b")
```


## List of available functions
The table shows the currently available generation and plotting functions.
It also references tutorial pages that provide in depth descriptions of the listed functions.

Note that some plots, e.g., [&plotTuneMultiCritResult] are not described here since they lack
a generation function.

The [%ggvis] functions are experimental and are subject to change, though they should work.
Most generate interactive [%shiny] applications, that automatically start and run locally.

| generation function              | ggplot2 plotting function | ggvis plotting function       | tutorial page                                             |
| -------------------------------- | ------------------------- | ----------------------------- | --------------------------------------------------------- |
| [&generateThreshVsPerfData]      | [&plotThresVsPerf]        | [&plotThreshVsPerfGGVIS]      | [Performance](performance.md)                             |
| [&generateCritDifferencesData]   | [&plotCritDifferences]    | --                            | [Benchmark Experiments](benchmark_experiments.md)         |
| [&generateFilterValuesData]      | [&plotFilterValues]       | [&plotFilterValuesGGVIS]      | [Feature Selection](feature_selection.md)                 |
| [&generateROCRCurvesData]        | [&plotROCRCurves]         | [&plotROCRCurvesGGVIS]        | [ROC Analysis](roc_analysis.md)                           |
| [&generateLearningCurveData]     | [&plotLearningCurve]      | [&plotLearningCurveGGVIS]     | [Learning Curves](learning_curve.md)                       |
| [&generatePartialPredictionData] | [&plotPartialPrediction]  | [&plotPartialPredictionGGVIS] | [Partial Prediction Plots](partial_prediction.md)         |
| [&generateCalibrationData]       | [&plotCalibration]        | --                            | [Classifier Calibration Plots](classifier_calibration.md) |
